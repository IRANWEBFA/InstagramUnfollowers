"use strict";const INSTAGRAM_HOSTNAME="www.instagram.com";let nonFollowersList=[],userIdsToUnfollow=[],isActiveProcess=!1;function sleep(e){return new Promise((t=>{setTimeout(t,e)}))}function getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}function afterUrl(e){return`https://www.instagram.com/graphql/query/?query_hash=3dec7e2c57367ef3da3d987d89f9dbc8&variables={"id":"${getCookie("ds_user_id")}","include_reel":"true","fetch_mutual":"false","first":"24","after":"${e}"}`}function unfollowUrl(e){return`https://www.instagram.com/web/friendships/${e}/unfollow/`}function $(e){const t=document.querySelector(e);if(null===t)throw new Error(`Element not found: ${e}`);return t}function renderResults(e){const t=[...e].sort(((e,t)=>e.username>t.username?1:-1));$(".toggle-all-checkbox").disabled=!1;const r=$(".results-container");r.innerHTML="";let s="";t.forEach((e=>{const t=-1!==userIdsToUnfollow.indexOf(parseInt(e.id));e.username.substring(0,1).toUpperCase()!==s&&(s=e.username[0].toUpperCase(),r.innerHTML+=`<div class='alphabet-character'>${s}</div>`),r.innerHTML+=`<label class='result-item'><div class='flex grow align-center'><img class='avatar' src=${e.profile_pic_url} /><div class='flex column'><a class='fs-xlarge' target='_blank' href='../${e.username}'>${e.username}</a><span class='fs-medium'>${e.full_name}</span></div>${e.is_verified?"<div class='verified-badge'>âœ“</div>":""}${e.is_private?"<span class='private-indicator'>Private</span>":""}</div><input class='account-checkbox' type='checkbox' onchange='toggleUser(${e.id})' ${t?"checked":""} /></label>`}))}async function scanNonFollowers(e=!0){if(isActiveProcess)return;isActiveProcess=!0;let t=[],r=!0,s=0,i=0,l=-1;let a=`https://www.instagram.com/graphql/query/?query_hash=3dec7e2c57367ef3da3d987d89f9dbc8&variables={"id":"${getCookie("ds_user_id")}","include_reel":"true","fetch_mutual":"false","first":"24"}`;const o=$(".progressbar-bar"),n=$(".progressbar-text"),c=$(".nonfollower-count"),d=$(".sleeping-text");for(;r;){let f;try{f=await fetch(a).then((e=>e.json()))}catch(e){continue}-1===l&&(l=f.data.user.edge_follow.count),r=f.data.user.edge_follow.page_info.has_next_page,a=afterUrl(f.data.user.edge_follow.page_info.end_cursor),i+=f.data.user.edge_follow.edges.length,f.data.user.edge_follow.edges.forEach((r=>{const s=r.node;e||s.is_verified||s.follows_viewer||t.push(s)}));const u=`${Math.ceil(i/l*100)}%`;n.innerHTML=u,o.style.width=u,c.innerHTML=t.length,renderResults(t),await sleep(1e3+400*Math.random()),s++,s>6&&(s=0,d.style.display="block",d.innerHTML="Sleeping 10s to prevent block...",await sleep(1e4)),d.style.display="none"}return o.style.backgroundColor="#59A942",n.innerHTML="DONE",isActiveProcess=!1,t}function toggleUser(e){userIdsToUnfollow=-1===userIdsToUnfollow.indexOf(e)?[...userIdsToUnfollow,e]:userIdsToUnfollow.filter((t=>t!==e)),$(".selected-user-count").innerHTML=`[${userIdsToUnfollow.length}]`}function toggleAll(e=!1){document.querySelectorAll(".account-checkbox").forEach((t=>t.checked=e)),userIdsToUnfollow=e?nonFollowersList.map((e=>e.id)):[],$(".selected-user-count").innerHTML=`[${userIdsToUnfollow.length}]`}async function copyList(){await navigator.clipboard.writeText([...nonFollowersList].sort(((e,t)=>e.username>t.username?1:-1)).map((e=>e.username)).join("\n")),alert("Usernames copied!")}async function unfollow(){if(isActiveProcess)return;if(0===userIdsToUnfollow.length)return alert("Select at least 1 user");if(!confirm("Are you sure?"))return;let e=getCookie("csrftoken");if(void 0===e)throw new Error("csrftoken missing");isActiveProcess=!0;const t=$(".sleeping-text"),r=$(".progressbar-bar"),s=$(".progressbar-text"),i=$(".results-container");i.innerHTML="",s.innerHTML="0%",r.style.width="0%";let l=0;for(const a of userIdsToUnfollow){const o=nonFollowersList.find((e=>e.id===a));try{await fetch(unfollowUrl(a),{headers:{"content-type":"application/x-www-form-urlencoded","x-csrftoken":e},method:"POST",credentials:"include"}),i.innerHTML+=`<div class='p-medium'>Unfollowed ${o.username} [${l+1}/${userIdsToUnfollow.length}]</div>`}catch(e){i.innerHTML+=`<div class='p-medium clr-red'>Failed ${o.username}</div>`}l++;const n=`${Math.ceil(l/userIdsToUnfollow.length*100)}%`;s.innerHTML=n,r.style.width=n,await sleep(3e3+2e3*Math.random()),l%5==0&&(t.style.display="block",t.innerHTML="Sleeping 5 minutes...",await sleep(3e5)),t.style.display="none"}r.style.backgroundColor="#59A942",s.innerHTML="DONE",isActiveProcess=!1,i.innerHTML+="<hr><div class='p-medium clr-green'>All done!</div>"}function initOverlay(){document.body.innerHTML=`<main class='iu'><div class='overlay'><header class='top-bar'><div class='logo' onclick='location.reload()'>InstagramUnfollowers | IRANHACKERS</div><label><input type='checkbox' class='include-verified-checkbox' checked /> Include verified</label><button class='copy-list' onclick='copyList()' disabled>COPY LIST</button><button class='fs-large clr-red' onclick='unfollow()'>UNFOLLOW <span class='selected-user-count'>[0]</span></button><input type='checkbox' class='toggle-all-checkbox' onclick='toggleAll(this.checked)' disabled /></header><button class='run-scan'>RUN</button><div class='results-container'></div><footer class='bottom-bar'><div>Non-followers: <span class='nonfollower-count'></span></div><div class='sleeping-text'></div><div class='progressbar-container'><div class='progressbar-bar'></div><span class='progressbar-text'>0%</span></div></footer></div></main>`,document.querySelector(".run-scan").addEventListener("click",(()=>{document.querySelector(".run-scan").remove(),document.querySelector(".include-verified-checkbox").disabled=!0,scanNonFollowers(!0).then((e=>{nonFollowersList=e,document.querySelector(".copy-list").disabled=!1}))}))}function init(){location.hostname===INSTAGRAM_HOSTNAME?initOverlay():alert("Run ONLY on instagram.com")}window.addEventListener("beforeunload",(e=>{if(isActiveProcess)return(e=e||window.event)&&(e.returnValue="Process running..."),"Process running..."})),init();
